#!D:\PyCharmProjects\Speedtest\env\Scripts\activate.batimport jsonimport subprocessimport loggingimport timeimport requestsimport pandasfrom datetime import datetimelogging.basicConfig(filename='speedtest.log', filemode='a', level=logging.INFO)server_list = [37382, 46774, 10987, 6386]host_list = ['8.8.4.4', 'ya.ru', 'amazon.com']bot_token = '1178689163:AAGzuJ961up3kwxpPR_mNxlG7y9NWkSFG7g'def exec_process(command, args):    process = subprocess.Popen([command] + args, stdout=subprocess.PIPE, stderr=subprocess.PIPE)    stdout, stderr = process.communicate()    if stderr:        logging.error(stderr)    if stderr:        logging.error(stderr)    return stdoutdef speed_test(server_id):    args = [        '--server-id', str(server_id),        '--format', 'json',    ]    stdout = exec_process('speedtest', args)    return json.loads(stdout.decode("utf-8"))def mtr_test(host, count=50):    args = [        host,        '-i', '0.2',        '--no-dns',        # COUNT        '-c', str(count),        # PACKETSIZE        '-s', str(1000),        '--json'    ]    stdout = exec_process('mtr', args)    return json.loads(stdout.decode("utf-8"))def main_speed_test(tariff_name):    # mtr test    # for host_ip in host_list:    #     # break  # Пока так    #     logging.info(f'Testing mtr to {host_ip}')    #     mtr_test_result = mtr_test(host_ip)    #     data = mtr_test_result_formatter(mtr_test_result)    #     print(data)    # for chat_id in chat_ids:    #     sendMessage(data, chat_id, 'HTML')    # speed test    data_set = {}    for server_id in server_list:        logging.info(f'Testing server id {server_id}')        speed_test_result = speed_test(server_id)        print(speed_test_result)        speed_test_result['tariff_name'] = tariff_name        data_set[speed_test_result['server']['id']] = speed_test_result    return data_set# print(main_speed_test(100))## ddd = {37382: {'type': 'result', 'timestamp': '2023-10-20T05:41:25Z',#                'ping': {'jitter': 0.768, 'latency': 2.443, 'low': 1.355, 'high': 2.974},#                'download': {'bandwidth': 11763817, 'bytes': 42401784, 'elapsed': 3607,#                             'latency': {'iqm': 40.47, 'low': 1.29, 'high': 54.361, 'jitter': 3.584}},#                'upload': {'bandwidth': 11700382, 'bytes': 42309112, 'elapsed': 3616,#                           'latency': {'iqm': 7.548, 'low': 2.472, 'high': 16.24, 'jitter': 1.609}}, 'isp': 'SPECTR IT',#                'interface': {'internalIp': '10.32.108.14', 'name': 'eno1', 'macAddr': 'EC:8E:B5:6E:F2:CE',#                              'isVpn': False, 'externalIp': '93.170.221.129'},#                'server': {'id': 37382, 'host': 'speedtest.st.uz', 'port': 8080, 'name': 'Sharq Telekom',#                           'location': 'Tashkent', 'country': 'Uzbekistan', 'ip': '217.29.116.215'},#                'result': {'id': '5fbab4f8-761d-40c7-be0b-5a36fa5ce6b1',#                           'url': 'https://www.speedtest.net/result/c/5fbab4f8-761d-40c7-be0b-5a36fa5ce6b1',#                           'persisted': True}, 'tariff_name': 100},#        46774: {'type': 'result', 'timestamp': '2023-10-20T05:41:38Z',#                'ping': {'jitter': 0.049, 'latency': 0.909, 'low': 0.836, 'high': 0.969},#                'download': {'bandwidth': 1317396, 'bytes': 9879704, 'elapsed': 7511,#                             'latency': {'iqm': 1.922, 'low': 1.061, 'high': 36.901, 'jitter': 0.947}},#                'upload': {'bandwidth': 11693955, 'bytes': 43538464, 'elapsed': 3725,#                           'latency': {'iqm': 10.445, 'low': 4.735, 'high': 14.057, 'jitter': 1.978}}, 'packetLoss': 0,#                'isp': 'SPECTR IT',#                'interface': {'internalIp': '10.32.108.14', 'name': 'eno1', 'macAddr': 'EC:8E:B5:6E:F2:CE',#                              'isVpn': False, 'externalIp': '93.170.221.129'},#                'server': {'id': 46774, 'host': 'speedtest2.uztelecom.uz', 'port': 8080, 'name': 'UZTELECOM',#                           'location': 'Tashkent', 'country': 'Uzbekistan', 'ip': '195.69.189.215'},#                'result': {'id': '5237f33d-0f22-494f-8846-2b41031067bb',#                           'url': 'https://www.speedtest.net/result/c/5237f33d-0f22-494f-8846-2b41031067bb',#                           'persisted': True}, 'tariff_name': 100},#        10987: {'type': 'result', 'timestamp': '2023-10-20T05:41:58Z',#                'ping': {'jitter': 0.035, 'latency': 64.685, 'low': 64.598, 'high': 64.719},#                'download': {'bandwidth': 1327154, 'bytes': 10723888, 'elapsed': 8112,#                             'latency': {'iqm': 105.43, 'low': 67.291, 'high': 350.658, 'jitter': 29.57}},#                'upload': {'bandwidth': 11704492, 'bytes': 109341968, 'elapsed': 9506,#                           'latency': {'iqm': 93.683, 'low': 56.087, 'high': 126.667, 'jitter': 19.041}},#                'isp': 'SPECTR IT',#                'interface': {'internalIp': '10.32.108.14', 'name': 'eno1', 'macAddr': 'EC:8E:B5:6E:F2:CE',#                              'isVpn': False, 'externalIp': '93.170.221.129'},#                'server': {'id': 10987, 'host': 'msk-speedtest2.corbina.net', 'port': 8080, 'name': 'Beeline MSK',#                           'location': 'Moscow', 'country': 'Russia', 'ip': '213.221.25.2'},#                'result': {'id': '9d0f81ac-bb52-484d-a903-0799fbe28faa',#                           'url': 'https://www.speedtest.net/result/c/9d0f81ac-bb52-484d-a903-0799fbe28faa',#                           'persisted': True}, 'tariff_name': 100},#        6386: {'type': 'result', 'timestamp': '2023-10-20T05:42:20Z',#               'ping': {'jitter': 0.075, 'latency': 67.317, 'low': 67.234, 'high': 67.376},#               'download': {'bandwidth': 1310002, 'bytes': 12908920, 'elapsed': 9902,#                            'latency': {'iqm': 89.902, 'low': 60.067, 'high': 128.378, 'jitter': 16.371}},#               'upload': {'bandwidth': 11702615, 'bytes': 110383085, 'elapsed': 9602,#                          'latency': {'iqm': 97.035, 'low': 62.713, 'high': 129.789, 'jitter': 22.254}}, 'packetLoss': 0,#               'isp': 'SPECTR IT',#               'interface': {'internalIp': '10.32.108.14', 'name': 'eno1', 'macAddr': 'EC:8E:B5:6E:F2:CE',#                             'isVpn': False, 'externalIp': '93.170.221.129'},#               'server': {'id': 6386, 'host': 'speedtest-stf.megafon.ru', 'port': 8080, 'name': 'MegaFon',#                          'location': 'Moscow', 'country': 'Russia', 'ip': '193.201.230.9'},#               'result': {'id': 'd622d35d-593d-4c51-bce3-e9441017b57f',#                          'url': 'https://www.speedtest.net/result/c/d622d35d-593d-4c51-bce3-e9441017b57f',#                          'persisted': True}, 'tariff_name': 100}}